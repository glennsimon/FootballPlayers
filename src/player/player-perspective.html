<html>
  <head> </head>
  <body>
    <div class="buttons">
      <button onclick="stand()">STAND</button>
      <button onclick="walk()">WALK</button>
      <button onclick="run()">RUN</button>
      <button onclick="flip()">FLIP</button>
    </div>
    <div class="outline"></div>
    <div class="floor">
      <div class="field">
        <div class="field-objective"></div>
      </div>
      <div class="waist">
        <div class="torso">
          <div class="surface__text torso__front">88</div>
          <div class="torso__back">
            <div class="surface__text name">FLINTSTONE</div>
            <div class="surface__text number">88</div>
          </div>
          <div class="torso__right"></div>
          <div class="torso__left"></div>
          <div class="torso__top"></div>
          <div class="torso__bottom"></div>
        </div>
        <div class="leg__left">
          <div class="thigh">
            <div class="thigh__front"></div>
            <div class="thigh__back"></div>
            <div class="thigh__right"></div>
            <div class="thigh__left"></div>
            <div class="thigh__top"></div>
            <div class="thigh__bottom"></div>
          </div>
          <div class="knee">
            <div class="calf">
              <div class="calf__front"></div>
              <div class="calf__back"></div>
              <div class="calf__right"></div>
              <div class="calf__left"></div>
              <div class="calf__top"></div>
              <div class="calf__bottom"></div>
            </div>
            <div class="foot">
              <div class="foot__front"></div>
              <div class="foot__back"></div>
              <div class="foot__right"></div>
              <div class="foot__left"></div>
              <div class="foot__top"></div>
              <div class="foot__bottom"></div>
            </div>
          </div>
        </div>
        <div class="leg__right">
          <div class="thigh">
            <div class="thigh__front"></div>
            <div class="thigh__back"></div>
            <div class="thigh__right"></div>
            <div class="thigh__left"></div>
            <div class="thigh__top"></div>
            <div class="thigh__bottom"></div>
          </div>
          <div class="knee">
            <div class="calf">
              <div class="calf__front"></div>
              <div class="calf__back"></div>
              <div class="calf__right"></div>
              <div class="calf__left"></div>
              <div class="calf__top"></div>
              <div class="calf__bottom"></div>
            </div>
            <div class="foot">
              <div class="foot__front"></div>
              <div class="foot__back"></div>
              <div class="foot__right"></div>
              <div class="foot__left"></div>
              <div class="foot__top"></div>
              <div class="foot__bottom"></div>
            </div>
          </div>
        </div>
        <div class="pads">
          <div class="arm__left">
            <div class="shoulder">
              <div class="shoulder__front"></div>
              <div class="shoulder__back"></div>
              <div class="shoulder__right"></div>
              <div class="shoulder__left"></div>
              <div class="shoulder__top"></div>
              <div class="shoulder__bottom"></div>
            </div>
            <div class="upper">
              <div class="upper__front"></div>
              <div class="upper__back"></div>
              <div class="upper__right"></div>
              <div class="upper__left"></div>
              <div class="upper__top"></div>
              <div class="upper__bottom"></div>
            </div>
            <div class="elbow">
              <div class="lower">
                <div class="lower__front"></div>
                <div class="lower__back"></div>
                <div class="lower__right"></div>
                <div class="lower__left"></div>
                <div class="lower__top"></div>
                <div class="lower__bottom"></div>
              </div>
            </div>
          </div>
          <div class="arm__right">
            <div class="shoulder">
              <div class="shoulder__front"></div>
              <div class="shoulder__back"></div>
              <div class="shoulder__right"></div>
              <div class="shoulder__left"></div>
              <div class="shoulder__top"></div>
              <div class="shoulder__bottom"></div>
            </div>
            <div class="upper">
              <div class="upper__front"></div>
              <div class="upper__back"></div>
              <div class="upper__right"></div>
              <div class="upper__left"></div>
              <div class="upper__top"></div>
              <div class="upper__bottom"></div>
            </div>
            <div class="elbow">
              <div class="lower">
                <div class="lower__front"></div>
                <div class="lower__back"></div>
                <div class="lower__right"></div>
                <div class="lower__left"></div>
                <div class="lower__top"></div>
                <div class="lower__bottom"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="neck">
          <div class="head">
            <div class="head__front">
              <div class="eyes">@&nbsp;&nbsp;&nbsp;@</div>
              <div class="mouth">XXXX</div>
            </div>
            <div class="head__right"></div>
            <div class="head__left"></div>
            <div class="head__bottom"></div>
          </div>
          <div class="helmet">
            <div class="shield__top"></div>
            <div class="shield__back"></div>
            <div class="helmet__trim helmet__back"></div>
            <div class="surface__text helmet__trim helmet__right">S</div>
            <div class="surface__text helmet__trim helmet__left">S</div>
            <div class="helmet__trim helmet__top"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // const faces = ['bottom', 'top', 'left', 'right', 'front', 'back'];
      const volumes = {
        torso: [10, 190, 60, 60, 45, 45],
        thigh: [140, 20, 25, 25, 25, 25],
        calf: [150, 10, 20, 20, 20, 20],
        foot: [0, 20, 20, 20, 60, 20],
        shoulder: [30, 30, 30, 30, 30, 30],
        upper: [110, 10, 20, 20, 20, 20],
        lower: [100, 20, 15, 15, 15, 15],
        head: [5, 65, 35, 35, 40, 40],
        helmet: [0, 100, 50, 50, 50, 50],
      };

      const offsets = {
        waist: 300,
        knee: -140,
        foot: -160,
        pads: 160,
        elbow: -120,
        neck: 200,
        corner: 30,
      };

      const fieldWidth = 2040;
      const fieldHeight = 920;
      let playerVector = [320, 320, 0];
      let objectiveVector = [
        (fieldWidth / 2 + playerVector[0]) / 2,
        (fieldHeight / 2 + playerVector[1]) / 2,
        8,
      ];
      const cameraVector = [fieldWidth / 2, fieldHeight / 2 + 640, 200];
      let sightlineVector = cameraVector.map((item, index) => {
        return item - objectiveVector[index];
      });
      let sightlineDistance =
        (sightlineVector[0] ** 2 +
          sightlineVector[1] ** 2 +
          sightlineVector[2] ** 2) **
        0.5;
      let sightUnitVector = sightlineVector.map((item, index) => {
        return item / sightlineDistance;
      });
      const fieldUnitVector = [0, 0, 1];
      let transformVector = sightUnitVector.map((item, index) => {
        return item - fieldUnitVector[index];
      });
      let newPsi =
        (180 *
          Math.atan(
            sightlineVector[2] /
              (sightlineVector[0] ** 2 + sightlineVector[1] ** 2) ** 0.5
          )) /
        Math.PI;
      let newTheta =
        (180 * Math.atan(sightlineVector[0] / sightlineVector[1])) / Math.PI;

      const playerPos = [320, 320, 0];
      const camPos = [fieldWidth / 2, fieldHeight / 2 + 640, 200];
      const objectivePos = [
        (fieldWidth / 2 + playerPos[0]) / 2,
        (fieldHeight / 2 + playerPos[1]) / 2,
        8,
      ];
      const delta = camPos.map((item, index) => {
        return item - objectivePos[index];
      });
      let distance = (delta[0] ** 2 + delta[1] ** 2 + delta[2] ** 2) ** 0.5;
      let theta = (180 * Math.atan(delta[0] / delta[1])) / Math.PI;
      let psi =
        (180 * Math.atan(delta[2] / (delta[0] ** 2 + delta[1] ** 2) ** 0.5)) /
        Math.PI;

      const holding = `transform-origin: ${cameraVector[0]}px ${cameraVector[1]}px;
        transform: perspective(${distance}px) translateY(200px) rotateX(${psi}deg) rotateZ(${theta}deg) translate3d(0px, 0px, 0px);`;

      const style = document.createElement('style');
      style.innerHTML = `
      * {
        box-sizing: border-box;
        position: absolute;
        transform-style: preserve-3d;
        backface-visibility: inherit;
        font-family: fantasy;
      }
      body {
        margin: 0;
        padding: 0;
        background: lightgray;
      }
      .floor {
        left: 0;
        top: 0;
        width: 0px;
        height: 0px;
        transform-origin: ${objectiveVector[0]}px ${objectiveVector[1]}px;
        transform: perspective(${sightlineDistance}px) rotateX(${
        90 - newPsi
      }deg) rotateZ(${newTheta}deg) ;
      }
      .surface__text {
        display: flex;
        justify-content: center;
        align-items: center;
        backface-visibility: none;
        font-size: 40px;
        color: white;
      }
      .buttons {
        display: flex;
        flex-direction: column;
      }
      button {
        position: static;
      }
      .outline {
        left: 0px;
        top: 0px;
        width: 2040px;
        height: 920px;
      }
      .field {
        left: 0px;
        top: 0px;
        width: 2040px;
        height: 920px;
        background: center / contain no-repeat url('./field.jpg');
      }
      .waist {
        left: ${playerVector[0]}px;
        top: ${playerVector[1]}px;
      }
      .field-objective {
        left: ${objectiveVector[0] - 10}px;
        top: ${objectiveVector[1] - 10}px;
        width: 20px;
        height: 20px;
        background: white;
        clip-path: polygon(
          9px 0, 11px 0, 11px 9px, 20px 9px, 20px 11px,
          11px 11px, 11px 20px, 9px 20px, 9px 11px, 0px 11px,
          0px 9px, 9px 9px, 9px 0 );
      }
      .torso div {
        font-size: 100px;
        background: red;
      }
      .torso__back {
        display: flex;
        flex-direction: column;
      }
      .torso__back .name {
        font-size: 20px;
        position: static;
        margin: auto;
      }
      .torso__back .number {
        position: static;
        margin: auto;
      }
      .shoulder div {
        background: red;
      }
      .head div {
        background: Sienna;
      }
      .helmet div {
        color: red;
        background: white;
      }
      .shield__top {
        left: ${-volumes.helmet[3]}px;
        top: ${-volumes.helmet[5]}px;
        width: ${volumes.helmet[1]}px;
        height: ${volumes.helmet[1]}px;
        transform: translateZ(${volumes.helmet[1] - offsets.corner}px)
      }
      .shield__back {
        transform: translateY(${volumes.helmet[5] - offsets.corner}px)
      }
      .thigh div {
        background: white;
      }
      .calf div {
        background: white;
      }
      .foot div {
        background: black;
      }
      .upper div {
        background: Sienna;
      }
      .lower div {
        background: Sienna;
      }
      .head__front {
        display: flex;
        flex-direction: column;
      }
      .eyes {
        position: static;
        margin: auto;
        color: black;
        font-size: 24px;
        font-weight: bold;
      }
      .mouth {
        position: static;
        margin: auto;
        color: white;
        font-weight: bold;
      }
      .helmet__trim {
        clip-path: polygon(${offsets.corner}px 0px, ${
        volumes.helmet[1] - offsets.corner
      }px 0px,
        ${volumes.helmet[1]}px ${offsets.corner}px,
        ${volumes.helmet[1]}px ${volumes.helmet[1] - offsets.corner}px,
        ${volumes.helmet[1] - offsets.corner}px ${volumes.helmet[1]}px,
        ${offsets.corner}px ${volumes.helmet[1]}px,
        0px ${volumes.helmet[1] - offsets.corner}px, 0px ${offsets.corner}px, ${
        offsets.corner
      }px 0px);
      }
      @keyframes fieldMotion {
        to {transform: translateY(-600px);}
      }
      @keyframes rotate15 {
        from {transform: rotateX(45deg)}
        to {transform: rotateX(45deg) rotateZ(360deg)}
      }
      @keyframes swing45 {
        33% {
          transform: rotateX(45deg);
        }
        66% {
          transform: rotateX(-45deg);
        }
      }
      @keyframes swing45_60 {
        33% {
          transform: rotateX(45deg);
        }
        66% {
          transform: rotateX(-60deg);
        }
      }
      @keyframes kneeSwingWalk {
        66% {
          transform: translateZ(${offsets.knee}px) rotateX(-30deg);
        }
      }
      @keyframes kneeSwingRun {
        66% {
          transform: translateZ(${offsets.knee}px) rotateX(-90deg);
        }
      }
      @keyframes elbows30 {
        to {
          transform: translateZ(${offsets.elbow}px) rotateX(30deg);
        }
      }
      @keyframes elbows90 {
        to {
          transform: translateZ(${offsets.elbow}px) rotateX(90deg);
          animation-timing-function: ease-in;
        }
      }
      @keyframes flip {
        from {
          transform rotateX(0deg);
        }
        to {
          transform: rotateX(360deg);
        }
      }
      `;

      const parts = Object.keys(volumes);
      const faces = ['bottom', 'top', 'left', 'right', 'front', 'back'];
      for (const part of parts) {
        for (const face of faces) {
          let index = faces.indexOf(face);
          if (index < 2) {
            style.innerHTML += `.${part}__${face} {
              left: ${-volumes[part][2]}px;
              top: ${-volumes[part][5]}px;
              width: ${volumes[part][2] + volumes[part][3]}px;
              height: ${volumes[part][4] + volumes[part][5]}px;
              transform: rotateY(${index === 1 ? 0 : 180}deg) translateZ(${
              volumes[part][index]
            }px);
            }
            `;
          } else if (index < 4) {
            style.innerHTML += `.${part}__${face} {
              left: ${
                (volumes[part][3] -
                  volumes[part][2] -
                  volumes[part][4] -
                  volumes[part][5]) /
                2
              }px;
              top: ${
                (volumes[part][4] -
                  volumes[part][5] -
                  volumes[part][1] -
                  volumes[part][0]) /
                2
              }px;
              width: ${volumes[part][4] + volumes[part][5]}px;
              height: ${volumes[part][0] + volumes[part][1]}px;
              transform: translateZ(${
                (volumes[part][1] - volumes[part][0]) / 2
              }px) rotateX(-90deg) rotateY(${
              index === 3 ? -90 : 90
            }deg) translateZ(${(volumes[part][2] + volumes[part][3]) / 2}px);
            }
            `;
          } else {
            style.innerHTML += `.${part}__${face} {
              left: ${-volumes[part][2]}px;
              top: ${
                (volumes[part][4] -
                  volumes[part][5] -
                  volumes[part][1] -
                  volumes[part][0]) /
                2
              }px;
              width: ${volumes[part][2] + volumes[part][3]}px;
              height: ${volumes[part][0] + volumes[part][1]}px;
              transform: translateZ(
              ${(volumes[part][1] - volumes[part][0]) / 2}px)
              rotateX(-90deg) rotateY(
                ${index === 4 ? 0 : 180}deg)
                translateZ(${(volumes[part][4] + volumes[part][5]) / 2}px);
            }
            `;
          }
        }
      }

      style.innerHTML += `
      .waist {
        transform: translateZ(${offsets.waist}px);
      }
      .leg__left {
        left: 30px;
      }
      .leg__right {
        left: -30px;
      }
      .knee {
        transform: translateZ(${offsets.knee}px);
      }
      .foot {
        transform: translateZ(${offsets.foot}px);
      }
      .pads {
        transform: translateZ(${offsets.pads}px);
      }
      .arm__left {
        left: 80px;
      }
      .arm__right {
        left: -80px;
      }
      .elbow {
        transform: translateZ(${offsets.elbow}px);
      }
      .neck {
        transform: translateZ(${offsets.neck}px);
      }
      `;
      document.head.appendChild(style);

      const animation = document.createElement('style');

      function stand() {
        animation.innerHTML = '';
      }

      function walk() {
        animation.innerHTML = `
        // .field {
        //   animation: fieldMotion 3s linear infinite;
        //   background:
        // }
      .arm__right {
        animation: 1s 0.5s infinite linear swing45;
      }
      .arm__left {
        animation: 1s infinite linear swing45;
      }
      .leg__right {
        animation: 1s infinite linear swing45;
      }
      .leg__left {
        animation: 1s 0.5s infinite linear swing45;
      }
      .knee {
        animation: 0.5s infinite linear kneeSwingWalk;
      }
      .elbow {
        animation: 0.5s forwards elbows30;
      }
      `;
      }

      function run() {
        animation.innerHTML = `
      .arm__right {
        animation: 0.5s 0.25s infinite linear swing45_60;
      }
      .arm__left {
        animation: 0.5s infinite linear swing45_60;
      }
      .leg__right {
        animation: 0.5s infinite linear swing45_60;
      }
      .leg__left {
        animation: 0.5s 0.25s infinite linear swing45_60;
      }
      .knee {
        animation: 0.25s infinite linear kneeSwingRun;
      }
      .elbow {
        animation: 0.5s forwards elbows90;
      }
      `;
      }

      function flip() {
        animation.innerHTML = `
      .torso {
        animation: 1s forwards flip;
      }
      `;
      }

      document.body.appendChild(animation);
    </script>
  </body>
</html>
